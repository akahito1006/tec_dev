<div class="container">
  <div class="row mb-3">
    <div class="col">
      <h4><%= @article.title %></h4>
    </div>
    <% if @article.user == current_user %>
      <div class="col-2 ml-auto">
        <%= link_to "編集する", edit_article_path(@article.id), class:"btn btn-primary py-0" %>
      </div>
    <% end %>
  </div>
  <div class="row mb-3">
    <div class="col-md-8 p-0 mx-auto text-center d-flex align-items-end">
      <div class="slideshow">
        <% @article.article_images.each do |img| %>
          <%= attachment_image_tag img, :image, class:"img-thumbnail", width:"200" %>
        <% end %>
      </div>
    </div>
  </div>
  <div class="row mb-3">
    <div class="col-md-9 p-0 mx-auto">
      <%= simple_format(h(@article.content)) %>
    </div>
  </div>
  
<!--会員-->
  <% if user_signed_in? %>
    <!--いいねボタン-->
    <div class="row mb-3">
      <div class="col-md-2">
        <% if @article.liked_by(current_user) %>
          <%= link_to "いいね♥#{@article.likes_count}", article_likes_path(@article), class:"btn btn-primary", method: :delete %>
        <% else %>
          <%= link_to "いいね♡#{@article.likes_count}", article_likes_path(@article), class:"btn btn-primary", method: :post %>
        <% end %>
      </div>
      <div class="col-md-2">
        <!--コメント入力窓の表示切り替え-->
        <button class="btn btn-success" type="button" data-toggle="collapse" data-target="#newcomment" aria-controls="newcomment" aria-expanded="false" aria-label="Toggle newcomment">
          コメントする
        </button>
      </div>
    </div>
    <!--コメント一覧-->
    <% @article.comments.each do |comment| %>
      <div class="row mb-3">
        <div class="col">
          <%= comment.user.name %>
          <%= comment.body %>
          <% if comment.user == current_user %>
            <%= link_to "削除", article_comment_path(comment.id), method: :delete, class:"btn btn-danger" %>
          <% end %>
        </div>
      </div>
    <% end %>
    <!--コメント入力窓-->
    <div class="row mb-3">
      <div class="col collapse" id="newcomment">
        <%= form_with(model:[@article, @comment], local: true) do |f| %>
          <%= f.text_area :body, class:"form-control", size:'40',placeholder: "コメントをここに" %>
          <%= f.submit "投稿", class:"btn btn-outline-success" %>
        <% end %>
      </div>
    </div>
    
<!--一般閲覧者-->
  <% else %>
    <!--いいねボタン -> ログイン画面へ遷移-->
    <div class="row mb-3">
      <div class="col-md-2">
        <%= link_to "いいね♡#{@article.likes_count}", article_likes_path(@article), class:"btn btn-primary", method: :post %>
      </div>
    </div>
    <!--コメント一覧-->
    <% @article.comments.each do |comment| %>
      <div class="row mb-3">
        <div class="col">
          <%= comment.user.name %>
          <%= comment.body %>
        </div>
      </div>
    <% end %>
    
  <% end %>
</div>